---
name: Titanium.Geolocation
summary: The top level Geolocation module. The Geolocation module is used for accessing device location based information.
description: |
    The geolocation capabilities of the underlying platforms are very different, so there
    are significant implementation differences between the platforms.

extends: Titanium.Module
since: "0.1"
platforms: [android, iphone, ipad, mobileweb]
methods:

  - name: forwardGeocoder
    summary: Resolves an address to a location.
    parameters:
      - name: address
        summary: address to resolve.
        type: String
      - name: callback
        summary: Function to invoke on success or failure. 
        type: Callback<ForwardGeocodeResponse>
    platforms: [android, iphone, ipad, mobileweb]

  - name: getCurrentHeading
    summary: Retrieves the current compass heading.
    parameters:
      - name: callback
        summary: Function to invoke on success or failure of obtaining the current heading. See heading event in <Titanium.Geolocation>.
        type: Callback<Object>
    platforms: [android, iphone, ipad, mobileweb]

  - name: getCurrentPosition
    summary: retrieve the last known location from the device. On Android, the radios are not turned on to update the location. On iOS the radios MAY be used if the location is too "old".
    parameters:
      - name: callback
        summary: function to invoke on success or failure of obtaining the current location. See location event in <Titanium.Geolocation>.
        type: Callback<Object>
    platforms: [android, iphone, ipad, mobileweb]
  - name: reverseGeocoder
    summary: Tries to resolve a location to an address.
    description: |
        The callback receives a <ReverseGeocodeResponse> object. If the request
        is successful, the object includes one or more addresses that are possible matches
        for the requested coordinates.
    parameters:
      - name: latitude
        summary: Latitude to search, specified in decimal degrees.
        type: Number
      - name: longitude
        summary: Longitude to search, specified in decimal degrees.
        type: Number
      - name: callback
        summary: Function to invoke on success or failure. 
        type: Callback<ReverseGeocodeResponse>
    platforms: [android, iphone, ipad, mobileweb]

events:

  - name: calibration
    summary: fired when the device detects interface and requires calibration. when this event is fired, the calibration UI is being displayed to the end user.
    platforms: [iphone, ipad]

  - name: heading
    summary: fired when a heading event is received
    properties:
      - name: code
        summary: if success is false, the error code if available
        platforms: [iphone, ipad]
      - name: success
        summary: boolean to indicate if the heading event was successfully received or an error occurred
      - name: error
        summary: if success is false, returns a string of the error description
      - name: heading
        summary: |
            heading results dictionary with the following sub-properties: `magneticHeading`, `trueHeading` (iPhone, iPad only), `accuracy`, `x` (iPhone, iPad only), `y` (iPhone, iPad only), `z` (iPhone, iPad only), `timestamp`.
    platforms: [android, iphone, ipad, mobileweb]

  - name: location
    summary: fired when a location event is received
    properties:
      - name: code
        summary: if success is false, the error code if available.
        platforms: [iphone, ipad, mobileweb]
      - name: success
        summary: boolean to indicate if the location event was successfully received or an error occurred
      - name: provider
        platforms: [android]
        summary: |
            location provider dictionary with the following sub-properties: `name`, `accuracy`, `power`, and `provider`.
      - name: coords
        summary: |
            location coordinates dictionary with the following sub-properties: `latitude`, `longitude`, `altitude`, `accuracy`, `altitudeAccuracy`, `heading`, `speed`, `timestamp`.
      - name: error
        summary: if success is false, returns a string of the error description

properties:

  - name: ACCURACY_BEST
    summary: accuracy constant
    type: Number
    permission: read-only

  - name: ACCURACY_HUNDRED_METERS
    summary: accuracy constant
    type: Number
    permission: read-only

  - name: ACCURACY_KILOMETER
    summary: accuracy constant
    type: Number
    permission: read-only

  - name: ACCURACY_NEAREST_TEN_METERS
    summary: accuracy constant
    type: Number
    permission: read-only

  - name: ACCURACY_THREE_KILOMETERS
    summary: accuracy constant
    type: Number
    permission: read-only

  - name: AUTHORIZATION_AUTHORIZED
    summary: authorization constant
    type: Number
    permission: read-only
    platforms: [iphone, ipad]

  - name: AUTHORIZATION_DENIED
    summary: authorization constant (user disabled authorization)
    type: Number
    permission: read-only
    platforms: [iphone, ipad]

  - name: AUTHORIZATION_RESTRICTED
    summary: authorization constant (system disabled authorization)
    type: Number
    permission: read-only
    platforms: [iphone, ipad]

  - name: AUTHORIZATION_UNKNOWN
    summary: authorization constant
    type: Number
    permission: read-only
    platforms: [iphone, ipad]

  - name: ERROR_DENIED
    summary: error constant
    platforms: [iphone, ipad]
    type: Number
    permission: read-only

  - name: ERROR_HEADING_FAILURE
    summary: error constant
    platforms: [iphone, ipad]
    type: Number
    permission: read-only

  - name: ERROR_LOCATION_UNKNOWN
    summary: error constant
    platforms: [iphone, ipad]
    type: Number
    permission: read-only

  - name: ERROR_NETWORK
    summary: error constant
    platforms: [iphone, ipad]
    type: Number
    permission: read-only

  - name: ERROR_REGION_MONITORING_DELAYED
    summary: error constant
    platforms: [iphone, ipad]
    permission: read-only
    osver:
        ios:
            min: "4.0"
    type: Number

  - name: ERROR_REGION_MONITORING_DENIED
    summary: error constant
    type: Number
    permission: read-only
    platforms: [iphone, ipad]
    osver:
        ios:
            min: "4.0"

  - name: ERROR_REGION_MONITORING_FAILURE
    summary: error constant
    type: Number
    permission: read-only
    platforms: [iphone, ipad]
    osver:
        ios:
            min: "4.0"

  - name: ERROR_TIMEOUT
    summary: error constant
    platforms: [mobileweb]
    type: Number
    permission: read-only

  - name: PROVIDER_GPS
    summary: The GPS location provider
    type: String
    permission: read-only
    platforms: [android]

  - name: PROVIDER_NETWORK
    summary: The Network location provider
    type: String
    permission: read-only
    platforms: [android]

  - name: distanceFilter
    summary: The minimum change of position (in meters) before a 'location' event is fired. Default is 0, meaning that location events are continuously generated.
    type: Number
    platforms: [iphone, ipad]

  - name: headingFilter
    summary: The minium change of heading (in degrees) before a 'heading' event is fired. Default is 0, meaning that heading events are continuously generated.
    type: Number
    platforms: [iphone, ipad]

  - name: locationServicesAuthorization
    summary: Returns an authorization constant indicating if the application has access to location services. Always returns AUTHORIZATION_UNKNOWN on pre-4.2 devices. Attempting to re-authorize when AUTHORIZATION_RESTRICTED will lead to issues
    type: Number
    platforms: [iphone, ipad]
    osver:
        ios:
            min: "4.2"

  - name: locationServicesEnabled
    summary: Indicates if the user has enabled or disabled location services for the device (not the application).
    description: |
        This method returns `true` if *any* location provider is enabled.

        On Android OS 2.2 and above, there is a new,  "passive" location provider that is enabled
        at all times, even when the user disables both the GPS and Network location providers.
        Therefore, this method always returns `true` on these devices.
    type: Boolean
    permission: read-only

  - name: preferredProvider
    summary: allows setting of the preferred location provider.  Returns undefined when the preferred provider is auto-detected
    type: String
    platforms: [android]

  - name: purpose
    summary: |
        Text to display in the permission dialog when requesting location
        services.
    description: |
        This property informs the end user why location services are being requested by 
        the application. This property is **required** starting in iOS 4.0.
        
    platforms: [iphone, ipad]
    type: String

  - name: showCalibration
    summary: Determines whether the compass calibration UI is shown if needed.
    description: |
        Set to `false` to disable display of the compass calibration UI. This may result
        in invalid heading data. 
    type: Boolean
    default: true
    platforms: [iphone, ipad]

---
name: ForwardGeocodeResponse
summary: |
    Simple object returned in the callback from the 
    [forwardGeocoder](Titanium.Geolocation.forwardGeocoder) method.

    Note that Android includes a number of extra fields.
properties: 

  - name: success
    summary: Indicates whether the request succeeded.
    type: Boolean 
    platforms: [iphone, ipad]

  - name: accuracy
    summary: Estimated accuracy of the geocoding, in meters.
    type: Number
    platforms: [iphone, ipad]

  - name: longitude
    summary: Longitude of the geocoded address.
    type: String
    platforms: [android, iphone, ipad]

  - name: latitude
    summary: Latitude of the geocoded address.
    type: String
    platforms: [android, iphone, ipad]

  - name: street
    summary: Street name, without street address.
    type: String
    platforms: [android]

  - name: street1
    summary: Street name.
    type: String
    platforms: [android]

  - name: city
    summary: City name.
    type: String
    platforms: [android]

  - name: region1
    summary: First line of region.
    type: String
    platforms: [android]

  - name: region2
    summary: 
    type: String
    platforms: [android]

  - name: postalCode
    summary: Postal code. 
    type: String
    platforms: [android]

  - name: country
    summary: Country name.
    type: String
    platforms: [android]

  - name: countryCode
    summary: Country code. 
    type: String. 
    platforms: [android]

  - name: country_code
    summary: Country code. Same as `country_code`.
    type: String
    platforms: [android]

  - name: displayAddress
    summary: Display address. Identical to `address`.
    type: String
    platforms: [android]

  - name: address
    summary: Full address.
    type: String
    platforms: [android]


---
name: ReverseGeocodeResponse
summary: |
    Simple object returned in the callback from the 
    [reverseGeocoder](Titanium.Geolocation.reverseGeocoder) method.

properties:

  - name: success
    summary: Indicates whether the request succeeded.
    type: Boolean 

  - name: places
    summary: An array of reverse-geocoded addresses matching the requested location.
    type: Array<GeocodedAddress>

---
name: GeocodedAddress
summary: |
    Simple object representing a place, returned in the callback from the 
    [reverseGeocoder](Titanium.Geolocation.reverseGeocoder) method.

properties:

  - name: street
    summary: Street name, without street address.
    type: String
    platforms: [android, iphone, ipad]

  - name: street1
    summary: Street name.
    type: String
    platforms: [android]

  - name: city
    summary: City name.
    type: String
    platforms: [android, iphone, ipad]

  - name: region1
    summary: First line of region.
    type: String
    platforms: [android]

  - name: region2
    summary: 
    type: String
    platforms: [android]

  - name: postalCode
    summary: Postal code. On iOS, use `zipcode`.
    type: String
    platforms: [android]

  - name: zipcode
    summary: Postal code. On Android, use `postalCode`.
    type: String
    platforms: [iphone, ipad]

  - name: country
    summary: Country name.
    type: String
    platforms: [android, iphone, ipad]

  - name: countryCode
    summary: Country code. On iOS, use `country_code`.
    type: String. 
    platforms: [android]

  - name: country_code
    summary: Country code. Same as `country_code`.
    type: String
    platforms: [android, iphone, ipad]

  - name: longitude
    summary: Longitude of the geocoded point.
    type: String
    platforms: [android, iphone, ipad]

  - name: latitude
    summary: Latitude of the geocoded point.
    type: String
    platforms: [android, iphone, ipad]

  - name: displayAddress
    summary: Display address. Identical to `address`.
    type: String
    platforms: [android]

  - name: address
    summary: Full address.
    type: String
    platforms: [android, iphone, ipad]

---
name: HeadingResponse
summary: Simple object holding compass heading data.
properties:

  - name: accuracy
    summary: Maximum deviation of the compass reading, in degrees.
    description: |
        On iOS, returns a negative value if the compass heading is invalid; for example,
        if there is magnetic interference, or if the compass is not calibrated.
    type: Number

  - name: x
    summary: Raw geomagnetic data for the X axis.
    type: Number

  - name: y
    summary: Raw geomagnetic data for the Y axis.
    type: Number

  - name: z
    summary: Raw geomagnetic data for the Z axis.
    type: Number
